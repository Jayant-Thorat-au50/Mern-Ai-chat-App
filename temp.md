{
  "text": "Okay, let's build a basic video calling application using the MERN stack (MongoDB, Express, React, Node.js) with ES6 features. I'll provide a file structure and code snippets for each part.  This example focuses on the core video calling functionality using WebRTC (Web Real-Time Communication). For simplicity, I'll omit authentication, user management, and advanced signaling features. We will use socket.io for signaling. \n\n**File Tree:**\n\n```\nvideo-call-app\n├── backend/\n│   ├── models/\n│   │   └── room.model.js\n│   ├── routes/\n│   │   └── room.route.js\n│   ├── config/\n│   │   └── db.js\n│   ├── server.js\n│   └── package.json\n├── frontend/\n│   ├── src/\n│   │   ├── components/\n│   │   │   ├── Video.js\n│   │   │   └── Room.js\n│   │   ├── App.js\n│   │   ├── index.js\n│   │   └── App.css\n│   ├── public/\n│   │   └── index.html\n│   └── package.json\n├── .gitignore\n└── README.md\n```",
  "fileTree": {
    "backend/package.json": {
      "content": "{\n  \"name\": \"backend\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Video calling app backend\",\n  \"main\": \"server.js\",\n  \"scripts\": {\n    \"start\": \"node server.js\",\n    \"dev\": \"nodemon server.js\"\n  },\n  \"dependencies\": {\n    \"cors\": \"^2.8.5\",\n    \"express\": \"^4.17.1\",\n    \"mongoose\": \"^6.0.5\",\n    \"socket.io\": \"^4.1.3\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^2.0.12\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}"
    },
    "backend/server.js": {
      "content": "// server.js\nconst express = require('express');\nconst http = require('http');\nconst socketIo = require('socket.io');\nconst cors = require('cors');\nconst mongoose = require('mongoose');\n\nconst app = express();\nconst server = http.createServer(app);\nconst io = socketIo(server, {\n  cors: { // Enable CORS for Socket.IO\n    origin: \"http://localhost:3000\", // Allow your React app's origin\n    methods: [\"GET\", \"POST\"]\n  }\n});\n\nconst roomRoutes = require('./routes/room.route');\n\n// Middleware\napp.use(cors());\napp.use(express.json());\n\n// MongoDB Connection (replace with your connection string)\nmongoose.connect('mongodb://localhost:27017/video-call-db', {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n}).then(() => console.log('Connected to MongoDB')).catch(err => console.error('MongoDB connection error:', err));\n\n// Routes\napp.use('/api/rooms', roomRoutes);\n\n// Socket.IO logic\nio.on('connection', (socket) => {\n  console.log('New client connected:', socket.id);\n\n  socket.on('joinRoom', (room) => {\n    socket.join(room);\n    console.log(`User ${socket.id} joined room ${room}`);\n  });\n\n  socket.on('offer', (data) => {\n    console.log(`Offer from ${socket.id} to ${data.target}`);\n    socket.to(data.target).emit('offer', data);\n  });\n\n  socket.on('answer', (data) => {\n    console.log(`Answer from ${socket.id} to ${data.target}`);\n    socket.to(data.target).emit('answer', data);\n  });\n\n  socket.on('iceCandidate', (data) => {\n    console.log(`ICE candidate from ${socket.id} to ${data.target}`);\n    socket.to(data.target).emit('iceCandidate', data);\n  });\n\n\n  socket.on('disconnect', () => {\n    console.log('Client disconnected:', socket.id);\n  });\n});\n\nconst port = process.env.PORT || 5000;\nserver.listen(port, () => console.log(`Server listening on port ${port}`));"
    },
    "backend/routes/room.route.js": {
      "content": "const express = require('express');\nconst router = express.Router();\nconst Room = require('../models/room.model');\n\n// Create a new room\nrouter.post('/', async (req, res) => {\n  try {\n    const room = new Room({ name: req.body.name });\n    const newRoom = await room.save();\n    res.status(201).json(newRoom);\n  } catch (err) {\n    res.status(400).json({ message: err.message });\n  }\n});\n\n// Get all rooms\nrouter.get('/', async (req, res) => {\n  try {\n    const rooms = await Room.find();\n    res.json(rooms);\n  } catch (err) {\n    res.status(500).json({ message: err.message });\n  }\n});\n\nmodule.exports = router;"
    },
    "backend/models/room.model.js": {
      "content": "const mongoose = require('mongoose');\n\nconst roomSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: true\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  }\n});\n\nmodule.exports = mongoose.model('Room', roomSchema);"
    },
    "backend/config/db.js": {
      "content": "// db.js\nconst mongoose = require('mongoose');\n\nconst connectDB = async () => {\n  try {\n    await mongoose.connect(process.env.MONGO_URI || 'mongodb://localhost:27017/video-call-db', {\n      useNewUrlParser: true,\n      useUnifiedTopology: true,     \n    });\n    console.log('MongoDB Connected...');\n  } catch (err) {\n    console.error(err.message);\n    // Exit process with failure\n    process.exit(1);\n  }\n};\n\nmodule.exports = connectDB;"
    },
    "frontend/package.json": {
      "content": "{\n  \"name\": \"frontend\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"react\": \"^17.0.2\",\n    \"react-dom\": \"^17.0.2\",\n    \"react-router-dom\": \"^5.3.0\",\n    \"react-scripts\": \"4.0.3\",\n    \"socket.io-client\": \"^4.1.3\",\n    \"web-vitals\": \"^1.0.1\"\n  },\n  \"scripts\": {\n    \"start\": \"react-scripts start\",\n    \"build\": \"react-scripts build\",\n    \"test\": \"react-scripts test\",\n    \"eject\": \"react-scripts eject\"\n  },\n  \"eslintConfig\": {\n    \"extends\": [\"react-app\", \"react-app/jest\"]\n  },\n  \"browserslist\": {\n    \"production\": [\">0.2%\", \"not dead\", \"not op_mini all\"],\n    \"development\": [\"last 1 chrome version\", \"last 1 firefox version\", \"last 1 safari version\"]\n  }\n}"
    },
    "frontend/src/App.js": {
      "content": "// frontend/src/App.js\nimport React from 'react';\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\nimport Room from './components/Room';\n\nfunction App() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/room/:roomId\" component={Room} />\n        <Route path=\"/\" >\n           <div>Home page</div>\n        </Route>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default App;"
    },
    "frontend/src/components/Room.js": {
      "content": "// frontend/src/components/Room.js\nimport React, { useState, useEffect, useRef } from 'react';\nimport io from 'socket.io-client';\nimport Video from './Video';\nimport { useParams } from 'react-router-dom';\n\nconst Room = () => {\n  const [peers, setPeers] = useState({});\n  const socketRef = useRef();\n  const userVideo = useRef();\n  const peersRef = useRef({});\n  const { roomId } = useParams();\n\n  useEffect(() => {\n    socketRef.current = io(\"http://localhost:5000\"); // Replace with your backend URL\n\n    // Access user's camera and microphone\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      userVideo.current.srcObject = stream;\n      socketRef.current.emit('joinRoom', roomId);\n\n      socketRef.current.on('offer', (data) => {\n        peersRef.current[data.from] = new RTCPeerConnection(configuration);\n\n        peersRef.current[data.from].ontrack = (event) => {\n          setPeers((prevPeers) => ({\n            ...prevPeers,\n            [data.from]: event.streams[0],\n          }));\n        };\n\n        peersRef.current[data.from].onicecandidate = (event) => {\n          if (event.candidate) {\n            socketRef.current.emit('iceCandidate', {\n              target: data.from,\n              candidate: event.candidate,\n            });\n          }\n        };\n\n\n        peersRef.current[data.from].setRemoteDescription(new RTCSessionDescription(data.offer));\n        peersRef.current[data.from].addStream(stream);\n        peersRef.current[data.from].createAnswer().then(answer => {\n          peersRef.current[data.from].setLocalDescription(answer);\n          socketRef.current.emit('answer', {\n            target: data.from,\n            answer: answer,\n          });\n        });\n      });\n\n      socketRef.current.on('answer', (data) => {\n        peersRef.current[data.from].setRemoteDescription(new RTCSessionDescription(data.answer));\n      });\n\n      socketRef.current.on('iceCandidate', (data) => {\n        if (data.candidate) {\n          peersRef.current[data.from].addIceCandidate(new RTCIceCandidate(data.candidate));\n        }\n      });\n    });\n\n\n  }, [roomId]);\n\n  const configuration = {\n    iceServers: [\n      { urls: 'stun:stun.l.google.com:19302' },\n      { urls: 'stun:global.stun.twilio.com:3478' }\n    ]\n  };\n\n  return (\n    <div>\n      <h1>Room: {roomId}</h1>\n      <Video ref={userVideo} muted={true} />\n      {Object.keys(peers).map(key => {\n        return <Video key={key} stream={peers[key]} />;\n      })}\n    </div>\n  );\n};\n\nexport default Room;"
    },
    "frontend/src/components/Video.js": {
      "content": "// frontend/src/components/Video.js\nimport React, { forwardRef } from 'react';\n\nconst Video = forwardRef((props, ref) => {\n  return (\n    <video playsInline autoPlay muted={props.muted} ref={ref} />\n  );\n});\n\nexport default Video;"
    },
    "frontend/src/index.js": {
      "content": "// frontend/src/index.js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"
    },
    "frontend/public/index.html": {
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <link rel=\"icon\" href=\"%PUBLIC_URL%/favicon.ico\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <meta name=\"theme-color\" content=\"#000000\" />\n    <meta\n      name=\"description\"\n      content=\"Web site created using create-react-app\"\n    />\n    <link rel=\"apple-touch-icon\" href=\"%PUBLIC_URL%/logo192.png\" />\n    <!--\n      manifest.json provides metadata used when your web app is installed on a\n      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/\n    -->\n    <link rel=\"manifest\" href=\"%PUBLIC_URL%/manifest.json\" />\n    <!--\n      Notice the use of %PUBLIC_URL% in the tags above.\n      It will be replaced with the URL of the `public` folder during the build.\n      Only files inside the `public` folder can be referenced from the HTML.\n\n      Unlike \"/favicon.ico\" or \"favicon.ico\", \"%PUBLIC_URL%/favicon.ico\" will\n      work correctly both with client-side routing and a non-root public URL.\n      Learn how to configure a non-root public URL by running `npm run build`.\n    -->\n    <title>React App</title>\n  </head>\n  <body>\n    <noscript>You need to enable JavaScript to run this app.</noscript>\n    <div id=\"root\"></div>\n    <!--\n      This HTML file is a template.\n      If you open it directly in the browser, you will see an empty page.\n\n      You can add webfonts, meta tags, or analytics to this file.\n      The build step will place the bundled scripts into the <body> tag.\n\n      To begin the development, run `npm start` or `yarn start`.\n      To create a production bundle, use `npm run build` or `yarn build`.\n    -->\n  </body>\n</html>"
    },
    "frontend/src/App.css": {
      "content": "/* src/App.css */\n\nbody {\n  font-family: sans-serif;\n  margin: 0;\n  padding: 0;\n  background-color: #f0f0f0;\n}\n\n.container {\n  max-width: 800px;\n  margin: 20px auto;\n  padding: 20px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n}\n\nh1 {\n  text-align: center;\n  color: #333;\n}\n\n/* Add more styles as needed */"
    },
    ".gitignore": {
      "content": "# dependencies\n/node_modules\n/.pnp\n.pnp.js\n\n# testing\n/coverage\n\n# production\n/build\n/dist\n\n# misc\n.DS_Store\n*.pem\n\n# debug\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\n\n# local env files\n.env.local\n.env.development.local\n\n# vercel\n.vercel\n\n"
    },
    "README.md": {
      "content": "# Video Calling App with MERN Stack and Socket.IO\n\nThis project demonstrates a basic video calling application built using the MERN stack (MongoDB, Express, React, Node.js) and Socket.IO for real-time communication.\n\n## Features\n\n- Real-time video and audio communication between users.\n- Room-based calling: Users can join a specific room to initiate a call.\n- Utilizes WebRTC for peer-to-peer media streaming.\n\n## Technologies Used\n\n- **Frontend:**\n  - React: JavaScript library for building user interfaces.\n  - Socket.IO client: For handling real-time bidirectional communication with the server.\n- **Backend:**\n  - Node.js: JavaScript runtime environment.\n  - Express: Web application framework for Node.js.\n  - Socket.IO: Library for enabling real-time, bidirectional communication between web clients and servers.\n  - Mongoose: MongoDB object modeling tool designed to work in an asynchronous environment.\n\n## Prerequisites\n\nBefore you begin, ensure you have the following installed:\n\n- Node.js and npm (Node Package Manager)\n- MongoDB\n\n## Installation\n\n1. Clone the repository:\n\n   ```bash\n   git clone <repository-url>\n   cd video-call-app\n   ```\n\n2. Install backend dependencies:\n\n   ```bash\n   cd backend\n   npm install\n   ```\n\n3. Install frontend dependencies:\n\n   ```bash\n   cd ../frontend\n   npm install\n   ```\n\n## Configuration\n\n### Backend\n\n- Create a `.env` file in the `backend` directory and add your MongoDB connection string:\n\n  ```\n  MONGO_URI=mongodb://localhost:27017/video-call-db\n  ```\n\n### Frontend\n\n- No specific configuration is needed for the frontend.\n\n## Running the Application\n\n1. Start the backend server:\n\n   ```bash\n   cd backend\n   npm run dev\n   ```\n\n   This will start the server on `http://localhost:5000`.\n\n2. Start the frontend development server:\n\n   ```bash\n   cd ../frontend\n   npm start\n   ```\n\n   This will start the React app on `http://localhost:3000`.\n\n3. Open two browser windows and navigate to `http://localhost:3000`.  Enter the same room ID in both windows to initiate a video call.\n\n## Notes:\n- This is a very basic example.  A production application would require a more robust signaling mechanism, TURN/STUN servers for NAT traversal, and proper error handling.\n-  The frontend directly connects to the signaling server.  A more complex application may utilize a REST API for certain tasks.\n\n## Contributing\n\nFeel free to contribute to the project by submitting pull requests, reporting issues, or suggesting improvements.\n"
    }
  }
}